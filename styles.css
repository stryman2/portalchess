/*
  זהו קובץ ה-CSS המלא והנקי שלך (V5).
  הסרתי את כל כללי הפורטל הכפולים והישנים
  והחלפתי אותם בכלל הנקי (V5) לטעינת תמונות
  עם z-index: 2 נכון.
*/
:root {
  --light: #eeeeee;
  --dark: #7085B6;

  --portal-white: #85c5ff; /* white-exclusive portals */
  --portal-black: #c8a0ff; /* black-exclusive portals */
  --portal-neutral: #526061; /* neutral portal */

  --highlight: #f7ec59aa;

  /* piece sizing and outline thickness */
  --piece-font-size: 28px;
  --white-stroke-width: 0.22 /* outline for white pieces (black color) */
  --black-stroke-width: 0px; /* outline for black pieces (white color) */
}

.visually-centered { max-width: 980px; margin: 0 auto; padding: 12px; }
body { font-family: system-ui, sans-serif; margin: 0; padding: 0; background: #000; color: #fff; -webkit-font-smoothing:antialiased; }

/* Mobile-first layout: stack controls and board vertically for narrow screens */
.app-header { padding: 14px 12px 6px 12px; }
.title { font-size: 20px; font-weight: 700; margin: 0 0 8px 0; }
.controls { display: flex; gap: 10px; align-items: center; margin: 0 12px 10px 12px; flex-wrap: wrap; }
.controls label { font-size: 15px; display: flex; gap: 8px; align-items: center; }
.controls button { padding: 8px 12px; font-size: 16px; border-radius: 8px; }

/* Board container: scale to viewport width on mobile, keep square via aspect-ratio */
.board {
  --board-size: min(94vw, 640px);
  width: var(--board-size);
  aspect-ratio: 1 / 1;
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  border: none; /* removed frame as requested */
  margin: 8px auto 20px auto;
  user-select: none;
  touch-action: manipulation;
  box-sizing: border-box;
}

.square {
  position: relative; display: flex; align-items: center; justify-content: center;
  font-size: calc(var(--board-size) / 13); cursor: pointer; -webkit-tap-highlight-color: rgba(0,0,0,0.05);
  color: #fff; /* ensure piece glyph contrast on black background */
}
.square.light { background: var(--light); }
.square.dark { background: var(--dark); }

/* expose a square-local variable for the canonical background color */
.square.light { --square-bg: var(--light); }
.square.dark  { --square-bg: var(--dark); }

/* ===================================================================
  עיצוב פורטלים נקי (V5) - פותר בעיית שכבות (z-index)
=================================================================== */

/*
  כלל בסיס שנדרש עבור ה-::before
*/
.portal-white,
.portal-black,
.portal-neutral {
    position: relative;
}

/*
  יצירת שכבת התמונה
*/
.portal-white::before,
.portal-black::before,
.portal-neutral::before {
    content: '';
    position: absolute;
    inset: 0; /* מכסה את כל המשבצת */
    
    /* הגדרות התמונה */
    background-position: center;
    background-repeat: no-repeat;
    background-size: 100%; /* גודל התמונה */
    
    /* שקיפות (סימן מים) */
    opacity: 1; /* אפשר לשחק עם זה (למשל 0.3) */
    
    /* פתרון הבעיה: מיקום בשכבה הנכונה */
    z-index: 2; /* מעל last-move (1), מתחת לנקודות (5) ולכלי (6) */
    
    pointer-events: none; /* שהתמונה לא תפריע ללחיצות */
}

/*
  טעינת התמונות הנכונות
*/
.portal-white::before {
    background-image: url('/images/portal_white.png');
}

.portal-black::before {
    background-image: url('/images/portal_black.png');
}

.portal-neutral::before {
    background-image: url('/images/portal_neutral.png');
}
/* --- סוף העיצוב החדש של הפורטלים --- */


/* ===================================================================
  מכאן ממשיך שאר הקוד המקורי שלך, ללא שינוי
 ===================================================================
*/

/* Ensure pieces render above portal visuals */
/* .piece { position: relative; z-index: 3; } -> נמחק, הוחלף בכלל החדש למטה */
/* .coords { position: absolute; z-index: 4; } -> נמחק, הוחלף בכלל החדש למטה */
.square.highlight { outline: none; }
/* Selected square (origin) — visible border so user knows which piece is selected */
.square.selected { outline: 3px solid var(--highlight); border-radius: 4px; }

/* Available move target: simple centered pseudo-element dot.
  We intentionally use a ::after pseudo-element so the square's original
  background (including portal fills) is not overridden and no DOM nodes
  are required. This is compact, performant, and avoids visual bleed. */
.square.move-target::after {
  content: '';
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%); /* דורס את ה-translateX של הריחוף */
  animation: none;                  /* מבטל את כל האנימציות */
  mix-blend-mode: normal;           /* מבטל את ערבוב הצבעים המוזר */ 
  width: 25%;
  height: 25%;
  border-radius: 50%;
  background: rgba(0, 183, 255, 0.4);
  pointer-events: none;
  z-index: 5; /* מעל הפורטלים (2) ומתחת לכלי (6) */
}
.coords { position: absolute; font-size: 12px; z-index: 8; pointer-events: none; }

/* File letters that appear on the bottom-most rank (a-h) */
.coords.file-label {
  left: 10%;
  bottom: 2px;
  transform: translateX(-50%);
  font-weight: 600;
  font-size: calc(var(--board-size) / 38);
}
.square.light .coords.file-label { color: rgba(0,0,0,0.65); }
.square.dark  .coords.file-label { color: rgba(255,255,255,0.85); }

/* Rank numbers that appear on the right-most file (1-8) */
.coords.rank-label {
  right: 4px;
  bottom: -25px;
  top: 50%;
  transform: translateY(-50%);
  font-weight: 600;
  font-size: calc(var(--board-size) / 40);
}
.square.light .coords.rank-label { color: rgba(0,0,0,0.65); }
.square.dark  .coords.rank-label { color: rgba(255,255,255,0.85); }

/* Pieces: single layer with strong contrasting stroke for clarity */
.piece { 
  line-height: 1;
  font-weight: 250;
  pointer-events: none; /* clicks register on the square */
  z-index: 6; /* ודאות שהוא מעל הכל, במיוחד מעל הנקודות (5) */
}

/* White = white fill + black outline */
.piece-w {
  color: #ffffff;
  -webkit-text-stroke: var(--white-stroke-width) #ffffff; /* Chrome/Edge/Safari */
  text-shadow: 2px 2px  5px #000000;
}

/* Black = black fill + white outline (very readable on dark squares) */
.piece-b {
  color: #000000;
  -webkit-text-stroke: var(--black-stroke-width) #ffffff;
 }
  /* ---------- Append this at the END of your existing styles.css ---------- */

  /* Clock display: ensure numbers contrast when the clock container is white */
  .clocks .clock {
    color: #111; /* dark numbers on light background */
    font-weight: 700;
  }
  .clocks .clock span {
    color: inherit;
  }

/* Controls panel (mode, AI, suggest, reset) */
.status-bar { margin: 0 12px 6px 12px; font-size: 15px; color: #fff; }

/* Larger screens: use a wider layout with horizontal spacing */
@media (min-width: 760px) {
  .app-header { display:flex; align-items:center; justify-content:space-between; padding: 18px 20px; }
  .title { font-size: 28px; }
  .controls { margin: 0; }
  .board { --board-size: 560px; }
}

/* Mobile: make the board full-bleed edge-to-edge and keep it square */
@media (max-width: 759px) {
  .visually-centered { padding: 0; }
  .app-header { padding-left: 10px; padding-right: 10px; }
  .board {
    --board-size: calc(100vw - env(safe-area-inset-left) - env(safe-area-inset-right));
    width: var(--board-size);
    margin: 0; /* full-bleed */
    max-width: none;
    border: none;
    box-shadow: none;
  }
  /* make sure controls and status are legible on black */
  .title, .controls label, .status-bar { color: #fff; }
  .controls button { color: #fff; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); }
}

/* Suggestion highlight (AI suggestion square) */
.square.suggest {
  outline: 3px dashed #1a73e8; /* blue dashed outline for suggested destination */
  box-shadow: 0 0 8px #1a73e8aa inset;
}

/* Slightly dim the neutral portal color when a cooldown is active */
.square.portal-neutral.cooldown {
  /* keep the painted neutral color readable while indicating cooldown */
  box-shadow: 0 0 6px 2px rgba(0,0,0,0.10) inset !important;
  opacity: 0.98;
}

/* Last-move highlight: applied to both origin and destination of the most recent move */
.square.last-move {
  /* Use a subtle filled background for origin/destination of the last move
     instead of the previous inset border. This makes it visually distinct
     from available-move dots. */
  position: relative;
  z-index: 1; /* יהיה מתחת לתמונת הפורטל (2) */
  background-color: #cdd26a !important; /* requested color */
  color: inherit;
}
.square.last-move::after { /* subtle outer glow for readability */
  content: '';
  position: absolute;
  left: 2px; right: 2px; top: 2px; bottom: 2px;
  border-radius: 6px;
  pointer-events: none;
  box-shadow: 0 0 10px rgba(205,210,106,0.25);
}

/* Ensure portal squares preserve the original board square colors
   (light/dark) in their center while allowing aura/pseudo-elements to
   render on top. This forces the background to the board tokens so
   portals never appear fully black or painted-over. */
.square.portal-white.light,
.square.portal-black.light,
.square.portal-neutral.light {
  background: var(--light) !important;
  color: inherit !important;
}
.square.portal-white.dark,
.square.portal-black.dark,
.square.portal-neutral.dark {
  background: var(--dark) !important;
  color: inherit !important;
}
/*
  שלב 1: הוסף את "מתכון" האנימציה הזה בסוף קובץ ה-CSS שלך.
  האנימציה הזו גורמת להילה "לפעום" על ידי שינוי גודל ה-blur והשקיפות.
*/
@keyframes pulseHalo {
  0% {
    /* התחלה: הילה קטנה ועדינה */
    box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.7);
  }
  50% {
    /* אמצע: הילה גדולה ובוהקת */
    box-shadow: 0 0 14px 6px rgba(255, 255, 255, 1);
  }
  100% {
    /* חזרה להתחלה */
    box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.7);
  }
}

/*
  שלב 2: עדכן את הכלל הקיים של הנקודה.
  אתה יכול פשוט להדביק את הכלל הזה בסוף ה-CSS שלך.
  הוא יחליף את ההגדרות הישנות של .square.move-target::after.
*/
.square.move-target::after {
  content: '';
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  mix-blend-mode: normal; 
  width: 25%;
  height: 25%;
  border-radius: 50%;
  
  /* צבע הנקודה הפנימית (שחור שקוף, כמו קודם) */
  background: rgba(0, 0, 0, 0.4); 
  
  pointer-events: none;
  z-index: 5;
  
  /* --- הנה השדרוג --- */
  
  /* 1. הוספת ההילה הלבנה עם ה-blur */
  box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.7);
  
  /* 2. הפעלת האנימציה המהבהבת */
  /* הפקודה "animation: none;" שהייתה פה - נמחקה */
  animation: pulseHalo 2s ease-in-out infinite;
}