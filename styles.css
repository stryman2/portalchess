:root {
  --light: #ece0c9;
  --dark: #ca7743d0;

  /* portal fill opacity: change this value to tweak portal transparency globally */
  --portal-fill-alpha: 0.8;

  --portal-white: #85c5ff; /* white-exclusive portals */
  --portal-black: #c8a0ff; /* black-exclusive portals */
  --portal-neutral: #526061; /* neutral portal */

  --highlight: #f7ec59aa;

  /* piece sizing and outline thickness */
  --piece-font-size: 28px;
  --white-stroke-width: 0.22 /* outline for white pieces (black color) */
  --black-stroke-width: 0px; /* outline for black pieces (white color) */
}

.visually-centered { max-width: 980px; margin: 0 auto; padding: 12px; }
body { font-family: system-ui, sans-serif; margin: 0; padding: 0; background: #fff; -webkit-font-smoothing:antialiased; }

/* Mobile-first layout: stack controls and board vertically for narrow screens */
.app-header { padding: 14px 12px 6px 12px; }
.title { font-size: 20px; font-weight: 700; margin: 0 0 8px 0; }
.controls { display: flex; gap: 10px; align-items: center; margin: 0 12px 10px 12px; flex-wrap: wrap; }
.controls label { font-size: 15px; display: flex; gap: 8px; align-items: center; }
.controls button { padding: 8px 12px; font-size: 16px; border-radius: 8px; }

/* Board container: scale to viewport width on mobile, keep square via aspect-ratio */
.board {
  --board-size: min(94vw, 640px);
  width: var(--board-size);
  aspect-ratio: 1 / 1;
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  border: 2px solid #333;
  margin: 8px auto 20px auto;
  user-select: none;
  touch-action: manipulation;
}

.square {
  position: relative; display: flex; align-items: center; justify-content: center;
  font-size: calc(var(--board-size) / 13); cursor: pointer; -webkit-tap-highlight-color: rgba(0,0,0,0.05);
}
.square.light { background: var(--light); }
.square.dark { background: var(--dark); }
.square.portal-white, .square.portal-black, .square.portal-neutral {
  /* keep positioning context for portal pseudo-elements */
  position: relative; overflow: visible;
}

/* Frame glow for portal squares (distinct per type) */
.square.portal-white {
  box-shadow: 0 0 12px 4px rgba(0,150,255,0.65);
  animation: portalFramePulse 3s ease-in-out infinite;
}
.square.portal-black {
  box-shadow: 0 0 12px 4px rgba(150,50,255,0.65);
  animation: portalFramePulse 3s ease-in-out infinite;
}
.square.portal-white {
  --stroke-color: #48abe0;
  --glow-color: rgba(72,171,224,0.65);
  animation: portalFramePulse 3s ease-in-out infinite;
  /* paint the square background to the requested color but with tweakable opacity */
  background: rgba(72,171,224,var(--portal-fill-alpha));
  color: #fff; /* keep any fallback glyphs visible */
  box-shadow: 0 0 0 2px var(--stroke-color), 0 0 14px 6px var(--glow-color);
}
.square.portal-black {
  --stroke-color: #8a2be2;
  --glow-color: rgba(138,43,226,0.65);
  animation: portalFramePulse 3s ease-in-out infinite;
  background: rgba(138,43,226,var(--portal-fill-alpha));
  color: #fff;
  box-shadow: 0 0 0 2px var(--stroke-color), 0 0 16px 8px var(--glow-color);
}
.square.portal-neutral {
  --stroke-color: #a0a594; /* neutral fill color per your latest request */
  --glow-color: rgba(160,165,148,0.45);
  animation: portalFramePulse 3s ease-in-out infinite;
  background: rgba(160,165,148,var(--portal-fill-alpha));
  color: #000;
  box-shadow: 0 0 0 2px var(--stroke-color), 0 0 12px 5px var(--glow-color);
}

.square.portal-white::before,
.square.portal-black::before,
.square.portal-neutral::before {
  content: "";
  position: absolute;
  inset: 6px;
  border-radius: 12px;
  pointer-events: none;
  filter: blur(6px) saturate(120%);
  mix-blend-mode: screen; /* helps the aura feel luminous while keeping square colors */
  z-index: 0;
  transform-origin: 50% 50%;
  animation: portalPulse 2.6s ease-in-out infinite;
}

.square.portal-white::before {
  background: radial-gradient(circle at 100% 80%, rgba(133,197,255,0.92) 100%, rgba(255,223,140,0.28) 100%, rgba(133,197,255,0.06) 70%, transparent 100%);
}
.square.portal-black::before {
  background: radial-gradient(circle at 50% 40%, rgba(200,160,255,0.92) 0%, rgba(90,40,120,0.28) 30%, rgba(60,20,90,0.06) 55%, transparent 70%);
  mix-blend-mode: multiply; /* darker, shadowy effect */
}
.square.portal-neutral::before {
  background: radial-gradient(circle at 50% 40%, rgba(207,210,214,0.9) 0%, rgba(180,150,110,0.28) 30%, rgba(200,200,190,0.06) 55%, transparent 70%);
  mix-blend-mode: overlay;
}

/* subtle moving shimmer overlay */
.square.portal-white::after,
.square.portal-black::after,
.square.portal-neutral::after {
  content: "";
  position: absolute;
  inset: 2px;
  border-radius: 14px;
  pointer-events: none;
  z-index: 1;
  background: linear-gradient(120deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 20%, rgba(0,0,0,0) 45%, rgba(255,255,255,0.02) 80%, rgba(255,255,255,0.06) 100%);
  mix-blend-mode: screen;
  transform: translateX(-15%);
  animation: portalShimmer 3.6s linear infinite;
}

/* Color-tint the shimmer so each portal reads distinctly (uses very low opacity tints) */
.square.portal-white::after { background-image: linear-gradient(120deg, rgba(133,197,255,0.12) 0%, rgba(255,223,140,0.06) 30%, rgba(133,197,255,0.02) 100%); }
.square.portal-black::after { background-image: linear-gradient(120deg, rgba(180,140,220,0.12) 0%, rgba(60,20,90,0.06) 30%, rgba(180,140,220,0.02) 100%); mix-blend-mode: multiply; }
.square.portal-neutral::after { background-image: linear-gradient(120deg, rgba(210,210,210,0.12) 0%, rgba(180,150,110,0.06) 30%, rgba(210,210,210,0.02) 100%); mix-blend-mode: overlay; }

@keyframes portalPulse {
  0% { transform: scale(0.98); opacity: 0.9; }
  50% { transform: scale(1.06); opacity: 1; }
  100% { transform: scale(0.98); opacity: 0.9; }
}

@keyframes portalShimmer {
  0% { transform: translateX(-25%); opacity: 0.85; }
  50% { transform: translateX(10%); opacity: 1; }
  100% { transform: translateX(-25%); opacity: 0.85; }
}

@keyframes portalFramePulse {
  0% { box-shadow: 0 0 10px 2px rgba(0,0,0,0.0); }
  40% { box-shadow: 0 0 18px 6px rgba(0,0,0,0.0); }
  50% { box-shadow: 0 0 22px 8px rgba(0,0,0,0.0); }
  100% { box-shadow: 0 0 10px 2px rgba(0,0,0,0.0); }
}

/* --- Heavier magical portal visuals (ring + animated sparks) --- */
.portal-visual {
  position: absolute;
  inset: 6px;
  border-radius: 12px;
  pointer-events: none;
  z-index: 0;
  display: block;
  transform-style: preserve-3d;
}
.portal-visual::before {
  /* bright energetic ring */
  content: '';
  position: absolute;
  inset: 8px;
  border-radius: 50%;
  background: conic-gradient(from 0deg at 50% 50%, rgba(255,255,255,0.9), transparent 20%);
  filter: blur(6px) saturate(160%);
  mix-blend-mode: screen;
  transform: translateZ(0) scale(1);
  box-shadow: 0 0 18px rgba(255,255,255,0.18), 0 0 40px rgba(255,255,255,0.06) inset;
  animation: ringSpin 4s linear infinite;
}
.portal-visual.portal-white::before {
  background: radial-gradient(circle at 50% 50%, rgba(200,240,255,0.95) 0%, rgba(133,197,255,0.9) 10%, rgba(133,197,255,0.06) 35%, transparent 45%);
  box-shadow: 0 0 26px rgba(133,197,255,0.35), 0 0 60px rgba(180,220,255,0.12) inset;
}
.portal-visual.portal-black::before {
  background: radial-gradient(circle at 50% 50%, rgba(240,220,255,0.95) 0%, rgba(180,140,220,0.9) 10%, rgba(60,20,90,0.08) 35%, transparent 45%);
  mix-blend-mode: screen;
  box-shadow: 0 0 28px rgba(180,140,220,0.25), 0 0 66px rgba(70,30,120,0.08) inset;
}
.portal-visual.portal-neutral::before {
  background: radial-gradient(circle at 50% 50%, rgba(245,245,245,0.88) 0%, rgba(220,200,170,0.8) 12%, rgba(200,180,160,0.06) 35%, transparent 45%);
  box-shadow: 0 0 22px rgba(220,200,170,0.18), 0 0 48px rgba(200,180,160,0.06) inset;
  mix-blend-mode: overlay;
}

.portal-visual i {
  position: absolute; left: 50%; top: 50%;
  width: 6px; height: 2px; border-radius: 2px;
  transform-origin: 0 50%;
  background: linear-gradient(90deg, rgba(255,255,255,0.98), rgba(255,255,255,0.2));
  box-shadow: 0 0 8px rgba(255,255,255,0.8);
  opacity: 0.95;
  transform: rotate(var(--angle)) translate(var(--dist)) rotate(var(--angle));
  animation: sparkSpin 2.6s linear infinite;
  animation-delay: var(--delay);
}
.portal-visual.portal-white i { background: linear-gradient(90deg, rgba(200,245,255,0.98), rgba(120,200,255,0.3)); box-shadow: 0 0 8px rgba(120,200,255,0.9); }
.portal-visual.portal-black i { background: linear-gradient(90deg, rgba(220,180,255,0.98), rgba(140,100,220,0.3)); box-shadow: 0 0 10px rgba(140,100,220,0.9); }
.portal-visual.portal-neutral i { background: linear-gradient(90deg, rgba(240,240,240,0.98), rgba(210,180,140,0.3)); box-shadow: 0 0 8px rgba(210,180,140,0.9); }

@keyframes ringSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@keyframes sparkSpin { 0% { transform: rotate(var(--angle)) translate(var(--dist)) rotate(var(--angle)) scaleX(1); opacity: 0.8; }
  50% { transform: rotate(calc(var(--angle) + 180deg)) translate(var(--dist)) rotate(calc(var(--angle) + 180deg)) scaleX(0.6); opacity: 1; }
  100% { transform: rotate(calc(var(--angle) + 360deg)) translate(var(--dist)) rotate(calc(var(--angle) + 360deg)) scaleX(1); opacity: 0.8; }
}

/* Ensure pieces render above portal visuals */
.piece { position: relative; z-index: 3; }
.coords { position: absolute; z-index: 4; }
.square.highlight { outline: 3px solid var(--highlight); }
.coords {
  position: absolute; font-size: 10px; color: #000a; left: 2px; bottom: 2px;
}

/* Pieces: single layer with strong contrasting stroke for clarity */
.piece {
  line-height: 1;
  font-weight: 250;
  pointer-events: none; /* clicks register on the square */
}

/* White = white fill + black outline */
.piece-w {
  color: #ffffff;
  -webkit-text-stroke: var(--white-stroke-width) #ffffff; /* Chrome/Edge/Safari */
  text-shadow: 2px 2px  5px #000000;
}

/* Black = black fill + white outline (very readable on dark squares) */
.piece-b {
  color: #000000;
  -webkit-text-stroke: var(--black-stroke-width) #ffffff;
 }
 /* ---------- Append this at the END of your existing styles.css ---------- */

/* Controls panel (mode, AI, suggest, reset) */
.status-bar { margin: 0 12px 6px 12px; font-size: 15px; }

/* Larger screens: use a wider layout with horizontal spacing */
@media (min-width: 760px) {
  .app-header { display:flex; align-items:center; justify-content:space-between; padding: 18px 20px; }
  .title { font-size: 28px; }
  .controls { margin: 0; }
  .board { --board-size: 560px; }
}

/* Suggestion highlight (AI suggestion square) */
.square.suggest {
  outline: 3px dashed #1a73e8; /* blue dashed outline for suggested destination */
  box-shadow: 0 0 8px #1a73e8aa inset;
}

/* Slightly dim the neutral portal color when a cooldown is active */
.square.portal-neutral.cooldown {
  /* keep the painted neutral color readable while indicating cooldown */
  box-shadow: 0 0 6px 2px rgba(0,0,0,0.10) inset !important;
  opacity: 0.98;
}